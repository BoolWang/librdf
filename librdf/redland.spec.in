# Note that this is NOT a relocatable package
%define name    @PACKAGE@
%define version @VERSION@
%define release 1
%define prefix  /usr

Summary:   Redland RDF Application Framework
Name:      %{name}
Version:   %{version}
Release:   %{release}
Prefix:    %{prefix}
Copyright: LGPL/MPL
Group:     System Environment/Libraries
Source:    http://www.redland.opensource.ac.uk/dist/source/%{name}-%{version}.tar.gz
URL:       http://www.redland.opensource.ac.uk/
BuildRoot: /tmp/%{name}-%{version}
Packager:  Dave Beckett <Dave.Beckett@bristol.ac.uk>
Docdir: %{prefix}/doc

%description

Redland is a library that provides a high-level interface for RDF
(Resource Description Framework) implemented in an object-based API.
It is modular and supports different RDF/XML parsers, storage
mechanisms and other elements. Redland is designed for applications
developers to provide RDF support in their applications as well as
for RDF developers to experiment with the technology.

%package devel
Summary: Libraries and header files for programs that use Redland.
Group: Development/Libraries
Requires: redland

%description devel
Header files for development with Redland

%package perl
Summary: Perl modules for the Redland RDF system
Group: Development/Libraries
Requires: redland

%description perl
The redland-perl package contains the parts of Redland that provide
an interface to Perl.

%prep
%setup

%build
if [ ! -f configure ]; then
  CFLAGS="$RPM_OPT_FLAGS" ./autogen.sh --prefix=%{prefix} --sysconfdir=/etc
else
  CFLAGS="$RPM_OPT_FLAGS" ./configure --prefix=%{prefix} --sysconfdir=/etc
fi

if [ "$SMP" != "" ]; then
  make -k -j$SMP "MAKE=make -k -j $SMP"
else
  make
fi

%install
[ -n "$RPM_BUILD_ROOT" -a "$RPM_BUILD_ROOT" != / ] && rm -rf $RPM_BUILD_ROOT

make prefix=$RPM_BUILD_ROOT%{prefix} sysconfdir=$RPM_BUILD_ROOT/etc install

cd perl

PACKAGE=%{name} VERSION=%{version} TOP_SRCDIR=.. perl Makefile.PL PREFIX=$RPM_BUILD_ROOT%{prefix}
make -f Makefile.perl install

cd ..

%clean
[ -n "$RPM_BUILD_ROOT" -a "$RPM_BUILD_ROOT" != / ] && rm -rf $RPM_BUILD_ROOT

%files
%defattr(0555, bin, bin)
%{prefix}/bin/redland-config
%{prefix}/lib/librdf.a

%defattr (0444, bin, bin, 0555)
%{prefix}/include/redland.h
%{prefix}/include/librdf.h 
%{prefix}/include/rdf_concepts.h
%{prefix}/include/rdf_digest.h
%{prefix}/include/rdf_hash.h 
%{prefix}/include/rdf_init.h
%{prefix}/include/rdf_iterator.h
%{prefix}/include/rdf_model.h
%{prefix}/include/rdf_node.h
%{prefix}/include/rdf_parser.h
%{prefix}/include/rdf_statement.h
%{prefix}/include/rdf_storage.h
%{prefix}/include/rdf_stream.h
%{prefix}/include/rdf_types.h
%{prefix}/include/rdf_uri.h
%{prefix}/include/rdf_utf8.h

%doc AUTHORS COPYING COPYING.LIB ChangeLog LICENSE.txt NEWS README TODO
%doc *.html

%files devel
%defattr(-, root, root)

%{prefix}/include/rdf_files.h 
%{prefix}/include/rdf_hash_bdb.h 
%{prefix}/include/rdf_hash_gdbm.h
%{prefix}/include/rdf_hash_memory.h
%{prefix}/include/rdf_heuristics.h
%{prefix}/include/rdf_list.h
%{prefix}/include/rdf_storage_hashes.h
%{prefix}/include/rdf_storage_list.h
%doc docs/README.html docs/perl.html docs/python.html docs/api

%files perl
%defattr(-, bin, bin)

%{prefix}/lib/perl5/site_perl/*/*/auto/redland/*
%{prefix}/lib/perl5/site_perl/*/*/Redland.pm
%{prefix}/lib/perl5/site_perl/*/*/RDF

%doc {prefix}/lib/perl5/man/man3/*

%changelog
