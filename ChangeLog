2006-04-24  Dave Beckett  <dave@dajobe.org>

	* librdf/rdf_uri.c: (librdf_uri_is_file_uri): Replace raptor
	1.4.9-deprecated raptor_uri_is_file_uri with
	raptor_uri_uri_string_is_file_uri

	* librdf/rdf_files.c: (main): Remove test for deprecated function.

	* librdf/rdf_storage_postgresql.c: Use UINT64_T_FMT instead of
	%llu for portability.
	(librdf_storage_postgresql_init): Use escaped_name in query.

	* librdf/rdf_storage_mysql.c: Use UINT64_T_FMT instead of %llu for
	portability.
	(librdf_storage_mysql_init): Use escaped_name in query.

	* librdf/rdf_types.h: Define UINT64_T_FMT with the portable
	sprintf formatting for a 64-bit unsigned int %I64u on win32,
	%llu (gcc) elsewhere.

2006-04-09  Dave Beckett  <dave@dajobe.org>

	* docs/redland-chapter-intro.xml,
	docs/redland-chapter-objects.xml, docs/redland-docs.xml: DocBook
	XML V4.3

2006-03-27  Dave Beckett  <dave@dajobe.org>

	* redland.sln: redland win32 build files update from John Barstow

	* librdf/win32/librdf.vcproj: redland win32 build files update
	from John Barstow

	* librdf/win32_rdf_config.h: redland win32 build files update from
	John Barstow

	* librdf/rdf_init.c: Protect #include <unistd.h> with defines as
	elsewhere

	* librdf/rdf_parser_raptor.c:
	(librdf_parser_raptor_new_statement_handler): Allow
	RAPTOR_IDENTIFIER_TYPE_RESOURCE and
	RAPTOR_IDENTIFIER_TYPE_PREDICATE raptor predicate types again.

	* examples/example5.c: Update to librdf_new_query change from long
	ago

2006-03-18  Dave Beckett  <dave@dajobe.org>

	* librdf/Makefile.am: fix make libraptor.la & librasqal.la rules

2006-03-15  Dave Beckett  <dave@dajobe.org>

	* COPYING, COPYING.LIB, README.html, TODO.html,
	librdf/rdf_parser_raptor.c: docs

2006-03-14  Dave Beckett  <dave@dajobe.org>

	* configure.ac: require rasqal 0.9.12

2006-03-13  Dave Beckett  <dave@dajobe.org>

	* configure.ac: BDB 4.4 now exists

2006-03-10  Dave Beckett  <dave@dajobe.org>

	* librdf/rdf_query.c: (main): Cast for size_t

2006-03-09  Dave Beckett  <dave@dajobe.org>

	* librdf/rdf_parser_raptor.c: Add close_fh flag to
	librdf_parser_raptor_stream_context to manage tidying up a FILE*.
	(librdf_parser_raptor_parse_file_handle_as_stream): Added close_fh
	flag to ask for fclose(fh) on
	exit. (librdf_parser_raptor_parse_as_stream_common): Do not
	fclose(fh) before it actually likely gets read.
	(librdf_parser_raptor_serialise_finished): fclose(fh) here if
	asked for.

	* librdf/rdf_parser_raptor.c:
	(librdf_parser_raptor_parse_file_handle_as_stream): Work with NULL
	base_uri.

2006-03-05  Dave Beckett  <dave@dajobe.org>

	* configure.ac: Require raptor 1.4.9 now

2006-03-02  Dave Beckett  <dave@dajobe.org>

	* librdf/rdf_log.h, librdf/rdf_serializer.h,
	librdf/rdf_serializer_internal.h: Include raptor.h when raptor
	definitions are used in headers

2006-02-19  Dave Beckett  <dave@dajobe.org>

	* librdf/rdf_parser_raptor.c:
	(librdf_parser_raptor_get_next_statement): Remove bad use of
	fclose() on a FILE* not opened here.

	* AUTHORS: update me

2006-02-15  Dave Beckett  <dave@dajobe.org>

	* configure.ac, src/win32_rdf_config.h: Bumped version to 1.0.4

	* Switched to Subversion version control.
	CVS tag for redland 1.0.3: redland_1_0_3
	Subversion revision ID for redland 1.0.3: r8564

	* Snapshotted redland_1_0_3 for 1.0.3 release

2006-02-11  Dave Beckett  <dave@dajobe.org>

	* librdf/rdf_node.c (librdf_new_node_from_literal,
	librdf_new_node_from_typed_literal): Fail if both a datatype
	URI/datatype flag and a language is given.  Fixes issue 0000069
	http://bugs.librdf.org/mantis/view.php?id=69
	(main): Add tests for this.
	
	* librdf/rdf_digest_sha1.c (librdf_digest_sha1_constructor):
	Fix over eager docstring fix.

	* librdf/rdf_digest_md5.c (librdf_digest_md5_constructor):
	Fix over eager docstring fix.

2006-01-26  Dave Beckett  <dave@dajobe.org>

	* configure.ac, Makefile.am, librdf/rdf_storage.c,
	librdf/rdf_storage_postgresql.c, librdf/rdf_storage_internal.h:
	Added PostgreSQL storage backend contributed by Shi Wenzhong based
	on the MySQL backend.  
	Fixes issue 0000046 http://bugs.librdf.org/mantis/view.php?id=46

	* librdf/rdf_init.c (librdf_world_get_genid):
	Include process ID in generated blank ID .
	Fixes bug 0000037 http://bugs.librdf.org/mantis/view.php?id=37
	(patch from Marc Powell)

	* utils/rdfproc.1: update storage, parser, query names

	* docs/redland-sections.txt: move REDLAND_DEPRECATED to general

	* docs/tmpl/unused.sgml: internal tokens

2006-01-25  Dave Beckett  <dave@dajobe.org>

	* raptor/docs/tmpl/section-feature.sgml: Sort
	RAPTOR_FEATURE_WRITER_XML_DECLARATION

	* configure.ac: Adjust byte, u32, u64 check

	* docs/redland-sections.txt: Removed never-existed function
	prototype librdf_world_set_uris_hash

	* librdf/rdf_init.h: Removed never-existed function prototype
	librdf_world_set_uris_hash

	* librdf/rdf_query_results.c, librdf/rdf_node.c,
	librdf/rdf_stream.h, librdf/rdf_node.h, librdf/rdf_storage.c:
	autodocs

	* librdf/rdf_storage.h: Removed never-existed function prototype
	librdf_storage_get

	* docs/redland-sections.txt: librdf_storage_get does not exist

	* docs/redland-sections.txt: Removed never-existed function
	prototype librdf_iterator_finished

	* librdf/rdf_iterator.h: Removed never-existed function prototype
	librdf_iterator_finished

	* librdf/rdf_files.h: Deprecated librdf_files_temporary_file_name

	* librdf/rdf_files.c (librdf_files_temporary_file_name): Deprecated

	* docs/redland-sections.txt:
	Add librdf_serializer_serialize_model_to_iostream

2006-01-16  Dave Beckett  <dave@dajobe.org>

	* redland.rdf.in: use download.librdf.org

	* rasqal/docs/librasqal.3: Updates for 0.9.11

	* rasqal/fix-groff-xhtml: style edits

2006-01-15  Dave Beckett  <dave@dajobe.org>

	* rasqal/src/rasqal_query.c: Change results indexing when using
	ORDER; the query->results_count is now a count (again) so starts
	from 1 when there is at least 1 result, indexing into item 0 of
	the query->results_sequence sequence.
	(rasqal_query_results_update): If result_count goes beyond range,
	adjust it down and return.
	(rasqal_query_execute): If a results sequence is created, but it
	is empty, set result count to 0, otherwise immediately check if it
	is finished by the limit/offset rules.
	(rasqal_query_results_next): Check result_count is finished and
	adjust down if it was.
	(rasqal_query_results_get_bindings,
	rasqal_query_results_get_binding_value,
	rasqal_query_results_get_binding_value_by_name): Adjusted to use
	result_count offset -1.

	* rasqal/src/rasqal_engine.c (rasqal_engine_check_limit_offset):
	Do not muck about with result_count here.

2006-01-12  Dave Beckett  <dave@dajobe.org>

	* rasqal/src/Makefile.am: Add strcasecmp_test_LDADD to link in
	libraries on some platforms.

	* rasqal/src/Makefile.am, rasqal/src/rasqal-config.1,
	rasqal/src/rasqal-config.in, rasqal/src/rasqal_general.c,
	rasqal/src/rasqal.h, rasqal/src/rasqal_engine.c,
	rasqal/src/rasqal_expr.c, rasqal/src/rasqal_graph_pattern.c,
	rasqal/src/rasqal_internal.h, rasqal/src/rasqal_map.c,
	rasqal/src/rasqal_query_test.c, rasqal/src/rasqal_raptor.c,
	rasqal/src/rasqal_redland.c, rasqal/src/rasqal_skiplist.c,
	rasqal/src/rasqal_xsd_datatypes.c, rasqal/src/rdql_common.h,
	rasqal/src/rdql_lexer.l, rasqal/src/rdql_parser.y,
	rasqal/src/sparql_common.h, rasqal/src/sparql_lexer.l,
	rasqal/src/sparql_parser.y, rasqal/src/win32_rasqal_config.h:
	Copyright 2006

	* rasqal/src/rasqal_query.c (rasqal_query_results_get_triple):
	Skip ill-formed triples with an unbound variable or the wrong type
	and give a warning.

	* rasqal/tests/sparql/ValueTesting/Makefile.am: Add boolean tests
	to dist.

	* rasqal/src/rasqal_literal.c (rasqal_literal_string_to_native):
	Accept "1" as an xsd:boolean true.

2006-01-11  Dave Beckett  <dave@dajobe.org>

	* rasqal/tests/sparql/ValueTesting/boolean-0.n3,
	rasqal/tests/sparql/ValueTesting/boolean-equiv-FALSE-result.n3,
	rasqal/tests/sparql/ValueTesting/boolean-equiv-FALSE.rq,
	rasqal/tests/sparql/ValueTesting/boolean-equiv-TRUE-result.n3,
	rasqal/tests/sparql/ValueTesting/boolean-equiv-TRUE.rq,
	rasqal/tests/sparql/ValueTesting/boolean-equiv-xsdType-result.n3,
	rasqal/tests/sparql/ValueTesting/boolean-equiv-xsdType.rq,
	rasqal/tests/sparql/ValueTesting/boolean-logical-OR-result.n3,
	rasqal/tests/sparql/ValueTesting/boolean-logical-OR.rq,
	rasqal/tests/sparql/ValueTesting/manifest.n3: Added more boolean
	tests from DAWG (unapproved)

2006-01-10  Dave Beckett  <dave@dajobe.org>

	* rasqal/src/rasqal_engine.c:
	(rasqal_graph_pattern_get_next_match,
	rasqal_engine_get_next_result): Return errors when query fails due
	to unimplemented sequence/union of graph patterns.

	* rasqal/utils/Makefile.am: Add src dir to CPPFLAGS

	* rasqal/src/rasqal_query.c:
	(rasqal_query_results_get_triple,
	rasqal_query_results_next_triple): Do not crash with DESCRIBE,
	return an empty graph always.

2006-01-06  Dave Beckett  <dave@dajobe.org>

	* rasqal/configure.ac: Add --disable-pcre and --disable-xml2
	options to configure to prevent automatic use of libpcre or
	libxml2 when found.  Patch from Mike Frysinger.  Addresses
	Issue#0000052 - http://bugs.librdf.org/mantis/view.php?id=52

	* rasqal/tests/sparql/ExprBuiltins/Makefile.am: Add u/iri tests to
	dist

	* rasqal/tests/sparql/ExprBuiltins/Makefile.am: Add langMatches
	tests to dist

	* rasqal/tests/sparql/ValueTesting/Makefile.am: Add typePromotion
	tests to dist

	* rasqal/src/rasqal.h: rasqal_op: RASQAL_EXPR_LANGMATCHES is last

	* rasqal/src/rasqal_expr.c (rasqal_expression_evaluate): Make
	LANG() return "" for non-literals as tests depend on it.  Return
	"" not "-".  Update LANGMATCHES() to make the wildcard the second
	arg; still does not do proper subtag matches.

	* rasqal/tests/sparql/ExprBuiltins/Makefile.am: q-langMatches-1
	works

2006-01-05  Dave Beckett  <dave@dajobe.org>

	* rasqal/src/rasqal_query.c: Do not emit XML header here as raptor
	1.4.8 xml writer does that automatically now.

2006-01-03  Dave Beckett  <dave@dajobe.org>

	* rasqal/src/rasqal_expr.c (rasqal_expression_evaluate): Add
	proper error checking to expression evaluating for arguments to
	unary operators UMINUS, TILDE and BANG.

	* rasqal/tests/sparql/ExprEquals/result-eq2-1.ttl,
	rasqal/tests/sparql/ExprEquals/result-eq2-graph-1.ttl,
	rasqal/tests/sparql/ValueTesting/dateTime-tz0.rq,
	rasqal/tests/sparql/ValueTesting/dateTime-tz1.rq,
	rasqal/tests/sparql/ValueTesting/extendedType-ne-pass.rq,
	rasqal/tests/sparql/ValueTesting/manifest.n3,
	rasqal/tests/sparql/ValueTesting/roman-result.n3,
	rasqal/tests/sparql/ValueTesting/typePromotion-0.n3,
	rasqal/tests/sparql/ValueTesting/typePromotion-decimal-decimal-fail-result.n3,
	rasqal/tests/sparql/ValueTesting/typePromotion-decimal-decimal-fail.rq,
	rasqal/tests/sparql/ValueTesting/typePromotion-decimal-decimal-pass-result.n3,
	rasqal/tests/sparql/ValueTesting/typePromotion-decimal-decimal-pass.rq:
	Updated DAWG test cases from CVS 2006-01-02

	* rasqal/tests/sparql/ValueTesting/Makefile.am: Added expected
	test failures: typePromotion-decimal-decimal-fail

	* rasqal/tests/sparql/ExprBuiltins/Makefile.am: Added expected
	test failures: datatype-1 LangMatches-1 LangMatches-2
	LangMatches-3 LangMatches-4

	* rasqal/tests/sparql/ExprBuiltins/data-builtin-1.ttl,
	rasqal/tests/sparql/ExprBuiltins/data-langMatches.ttl,
	rasqal/tests/sparql/ExprBuiltins/manifest.ttl,
	rasqal/tests/sparql/ExprBuiltins/q-iri-1.rq,
	rasqal/tests/sparql/ExprBuiltins/q-langMatches-1.rq,
	rasqal/tests/sparql/ExprBuiltins/q-langMatches-2.rq,
	rasqal/tests/sparql/ExprBuiltins/q-langMatches-3.rq,
	rasqal/tests/sparql/ExprBuiltins/q-langMatches-4.rq,
	rasqal/tests/sparql/ExprBuiltins/result-iri-1.ttl,
	rasqal/tests/sparql/ExprBuiltins/result-langMatches-1.ttl,
	rasqal/tests/sparql/ExprBuiltins/result-langMatches-2.ttl,
	rasqal/tests/sparql/ExprBuiltins/result-langMatches-3.ttl,
	rasqal/tests/sparql/ExprBuiltins/result-langMatches-4.ttl,
	rasqal/tests/sparql/ExprBuiltins/result-str-4.ttl: Updated DAWG
	test cases from CVS 2006-01-02

	* raptor/src/raptor_namespace.c (main): Cast for string

2006-01-02  Dave Beckett  <dave@dajobe.org>

	* raptor/src/n3_lexer.l: Apply more turtle to n3 changes for
	names.

	* raptor/src/n3_parser.y: Update N3 parser to turtle.

	* raptor/src/n3_lexer.l: Update N3 lexer to turtle.

	* raptor/src/raptor_general.c, raptor/src/raptor_namespace.c,
	raptor/src/turtle_parser.y, raptor/src/turtle_lexer.l: 2006 and
	urls

	* raptor/tests/turtle/Makefile.am: Added test-23

	* raptor/tests/turtle/test-23.out,
	raptor/tests/turtle/test-23.ttl: Test long literal ending in a
	double quote

	* raptor/tests/turtle/manifest.ttl: Added test-23 testing long
	literal ending in a double quote

	* raptor/src/turtle_common.c
	(raptor_stringbuffer_append_turtle_string): Fix comment to match
	code and report hex char of bad escapes.

	* raptor/src/turtle_lexer.l: Try to handle \-escapes inside """
	properly.

	* raptor/tests/turtle/README.txt: url

	* raptor/tests/turtle/Makefile.am: Add TEST_MANIFEST_FILES to
	tests.zip

	* raptor/tests/turtle/manifest-bad.ttl,
	raptor/tests/turtle/manifest.ttl: Updated manifests from Arjohn
	Kampman

	* raptor/src/turtle_parser.y (DECIMAL_LITERAL): Added turtle
	decimal and double after SPARQL 2005-11-23

	* raptor/src/turtle_lexer.l: Added turtle decimal and double after
	SPARQL 2005-11-23

	* raptor/tests/turtle/Makefile.am,
	raptor/tests/turtle/test-19.out, raptor/tests/turtle/test-21.out,
	raptor/tests/turtle/test-21.ttl, raptor/tests/turtle/test-22.out,
	raptor/tests/turtle/test-22.ttl: Added decimal/double/integer +
	and - checks from
	http://lists.w3.org/Archives/Public/public-cwm-talk/2005OctDec/0017.html

	* rasqal/tests/sparql/ExprEquals/result-eq2-graph-1.ttl: new
	result

	* rasqal/docs/tmpl/section-literal.sgml: Added
	rasqal_new_decimal_literal

	* rasqal/docs/tmpl/section-expression.sgml: Added
	@RASQAL_EXPR_LANGMATCHES:

	* rasqal/docs/rasqal-sections.txt: Added
	rasqal_new_decimal_literal

	* rasqal/src/sparql_parser.y: Updates for SPARQL Query Language
	for RDF, 23 November 2005
	http://www.w3.org/TR/2005/WD-rdf-sparql-query-20051123/ Including
	many renamings of tokens to match grammar.
	(DECIMAL_LITERAL): Added.
	(GraphNodeListNotEmpty): Renamed from ItemList
	(GraphNode): Renamed from Object
	(GraphTerm): Renamed from RDFTerm. Added DECIMAL_LITERAL option.
	(VarOrTerm): Added.
	(VarOrBnodeOrURI): Replaced by VarOrBlankNodeOrIRIref.
	(Select/Construct/Describe/AskQuery): Renamed from *Clause.
	(Prolog): Re-added.
	(BuiltInCall): Added LANGMATCHES option.

	* rasqal/src/sparql_lexer.l (DECIMAl, DOUBLE, EXPONENT): Added.
	Support SPARQL decimal and double literal syntax and return new
	DECIMAL_LITERAL when there is a '.' else FLOATING_LITERAL with an
	EXPONENT

	* rasqal/src/rasqal_literal.c (rasqal_new_decimal_literal): Added
	to make a decimal literal
	(xsd:decimal).

	* rasqal/src/rasqal.h: Added prototype for
	rasqal_new_decimal_literal

	* rasqal/tests/sparql/SyntaxDev/Syntax-SPARQL2/Makefile.am:
	syntax-general-03.rq and syntax-function-01.rq now work (7
	failures remain)

	* rasqal/tests/sparql/ExprEquals/result-eq2-1.ttl,
	rasqal/tests/sparql/ExprEquals/query-eq-2.rq,
	rasqal/tests/sparql/ExprEquals/query-eq-graph-2.rq,
	rasqal/tests/sparql/ExprEquals/Makefile.am,
	rasqal/tests/sparql/ExprEquals/data-eq.ttl,
	rasqal/tests/sparql/ExprEquals/manifest.n3: Updates for decimal
	syntax changes and equality rules

2006-01-01  Dave Beckett  <dave@dajobe.org>

	* rasqal/src/sparql_parser.y (PrefixDeclOpt): gcc const string
	warning fix.

	* rasqal/src/sparql_parser.y (PrefixDeclOpt): Generate a warning
	if a PREFIX appears more than once.  Check added after update in
	http://www.w3.org/TR/2005/WD-rdf-sparql-query-20051123/

	* raptor/src/raptor_namespace.c
	(raptor_namespaces_find_namespace): Handle searching for default
	namespace with prefix=NULL.
	(main): Add test code for above.

	* rasqal/src/rasqal_expr.c (rasqal_expression_evaluate): Added
	SPARQL trinary logic evaluation of AND and OR expressions for
	T,F,E following the truth table in
	http://www.w3.org/TR/2005/WD-rdf-sparql-query-20051123/#truthTable

	* rasqal/src/rasqal_expr.c (rasqal_expression_clear,
	rasqal_expression_visit, rasqal_expression_print,
	rasqal_expression_is_constant): Added SPARQL_EXPR_LANGMATCHEs to
	switch statements as a new 2-argument expression.
	(rasqal_expression_evaluate): Added a simple evaluation for
	SPARQL_EXPR_LANGMATCHES that handles '*' and otherwise does a case
	independent string compare.  This is not a full implementation by
	any means.  Support for the new SPARQL keyword langMatches added
	in http://www.w3.org/TR/2005/WD-rdf-sparql-query-20051123/

	* rasqal/src/sparql_parser.y (BuiltInCall): Added SPARQL
	langMatches 2-argument expresson after addition in
	http://www.w3.org/TR/2005/WD-rdf-sparql-query-20051123/

	* rasqal/src/rasqal.h: Added SPARQL_EXPR_LANGMATCHES for SPARQL
	langMatches expression

	* rasqal/src/sparql_lexer.l: Allow _ at the start of sparql
	variable names, as changed in
	http://www.w3.org/TR/2005/WD-rdf-sparql-query-20051123/
	(enum sparql_name_check_flags): Remove
	SPARQL_NAME_CHECK_NO_UL_FIRST for varname.
	(NCCHAR1p): Renamed from NCCHAR1 - no _.
	(NCCHAR1): Added to aloow _
	(VARNAME, NCCHAR, NCNAME): No need to use _ here, NCCHAR1 has it.
	(NCNAME_PREFIX): Use NCCHAR1p at start, no _ still.

	* rasqal/src/sparql_lexer.l, rasqal/src/sparql_parser.y: Added
	LANGMATCHES token (case independent) new in
	http://www.w3.org/TR/2005/WD-rdf-sparql-query-20051123/

	* rasqal/src/sparql_lexer.l: Allow isiri (case independent)
	returning ISURI token

